### Android N 和 O 新特性概览

[Android N 官方文档介绍](https://developer.android.google.cn/about/versions/nougat/android-7.0.html)

| 特性          | 说明                                       |
| ----------- | ---------------------------------------- |
| 多窗口模式       | 可以将两个应用显示在同一屏幕上，并调整每个应用显示窗口的大小，可通过设置Activity的最小大小来限制窗口的最小大小。 |
| 通知变更        | 拓展了通知的功能，支持对通知的自定义反馈操作（类似Snakebar）与信息输入操作 |
| JIT/AOT     | 为节约功耗和内存提供的运行时编译系统，同时对安装应用做了优化           |
| 低电耗模式       | 通过延迟CPU工作与网络请求减少电耗                       |
| 后台优化        | 拓展已有的JobScheduler API 用以进行后台定时、状态触发等操作，降低电量与内存使用 |
| SurfaceView | 7.0以上的SurfaceView支持视频或动画运行时简单的缩放与平移（类TextureView），且效率更高。 |
| 号码屏蔽与来电过滤   | 允许设置来电黑名单直接实现被屏蔽号码的拦截                    |
| WebView     | 使用Chrom内核作为WebView的默认实现，且可自定义WebView的供应方并设置其在独立进程中运行；JS上下文会在WebView新页面打开时重置 |
| 辅助功能增强      | 自带人脸追踪、眼球追踪等功能                           |
| 直接启动        | 在手机未解锁的状态下可以访问非加密区数据 （暂时看不出有什么用）         |
| v2签名        | 提高应用安装速度与安全性                             |
| 文件目录访问      | 可以直接访问系统的已分类目录，如Picture，而不需要手动对目录对象类型进行判断 |
| 虚拟文件        | 可通过uri构造一定类型的无数据文件，可由其对象请求真正的字节流。        |



[Android O 官方文档介绍](https://developer.android.google.cn/about/versions/oreo/android-8.0.html)

**加粗**的内容需要有空的时候依次试一遍。

| 特性                          | 说明                                                         |
| ----------------------------- | ------------------------------------------------------------ |
| 通知扩展                      | 可对通知类别进行分类，拦截或放行自定义类别的通知；增加Launcher图标之上显示未读信息小标志（仿IOS?）；可休眠通知；可设置通知显示超时；可区分通知由用户清除还是系统移除；设置通知的背景色；可设置通知的消息样式。 |
| **自动填充框架**              | 可对标准TextView等文本显示控件提供以前输入过的文本自动填充的服务 |
| 画中画模式                    | 可让窗口处于暂停状态下时仍进行画面绘制，其将处于onPause() 与 onStop()之间 |
| **字体资源设置**              | 可向系统申请使用已存在的字体，并支持在资源目录中设置font目录，并直接进行字体引用 |
| **字体大小自适配**            | 可以对TextView设置属性使其自动调整字体大小                   |
| 多显示器展示与最大纵横比      | 支持多屏展示Activity 并不再设定默认最大纵横比（不再需要额外适配全面屏手机） |
| 统一边距                      | 对纵向和横向的内外边距可以由两个属性设置完成                 |
| 视图焦点                      | View默认可获得焦点                                           |
| findViewById                  | 返回值由View类型变为具体类型                                 |
| **JobScheduler优化**          |                                                              |
| 提示窗口                      | SYSTEM_ALERT_WINDOW 其他类型的窗口将始终显示在使用 `TYPE_APPLICATION_OVERLAY` 窗口类型的窗口下方 |
| 支持蓝牙5.0                   |                                                              |
| Instrumentation支持多进程测试 | 需要设定`android:targetProcess`属性                          |
| 后台限制                      | 后台应用禁止启动后台服务，且会自动停止空闲的后台服务（在进入后台后有几分钟的白名单时间，然后进入空闲期），且无法静态注册非指定签名的隐式广播（部分系统级广播例外） |
| 支持键盘导航                  | 使用PC键盘移动焦点时View层会展示默认的焦点突出颜色，且支持主动划分键盘区块 |
| 安全性                        | WebView不再支持SSLv3，不再具有安全协议不匹配回退重试的逻辑，且始终运行在单独进程中；运行时权限申请时，**不会一次性将所有同组权限全部授予**，但当授予了组内一项权限时，下一个组内权限会自动通过 |



[Android P 官方文档介绍](https://developer.android.google.cn/about/versions/pie/android-9.0?hl=zh_cn)

**加粗**的内容需要有空的时候依次试一遍。

| 特性                                    | 说明                                                         |
| --------------------------------------- | ------------------------------------------------------------ |
| 支持室内定位                            | 在运行 Android 9 且具有硬件支持的设备上，应用可以使用 `RTT API`来测量与附近支持 RTT 的 Wi-Fi *接入点* (AP) 的距离 |
| **缺口屏幕支持**                        | 提供API进行对刘海屏、水滴屏等屏幕的检测和自动布局优化        |
| 通知功能加强                            | 通知快捷回复功能加强包括支持对象识别，发送图片，智能回复模板等；支持屏蔽通知类别组，并提供更多种的勿扰模式 |
| 多摄像头支持                            | 支持多摄像头、多视频流的访问                                 |
| **ImageDecoder与AnimatedImageDrawable** | 使用ImageDecoder代替BitmapFactory来解析Bitmap及Drawable，并支持绘制圆角遮罩等功能；支持用AnimatedImageDrawable展示Gif图，解码线程与渲染线程分离。 |
| 支持HDR视频                             | 支持HDR视频解码及其他媒体功能拓展                            |
| 安全增强功能                            | 启用**Android Protected Confirmation**进行操作加密确认；指纹验证时使用**统一生物识别身份验证对话框**；通过**StrongBox Keymaster**进行秘钥存储与校验；保护秘钥导入过程，全程不会以明文的形式存在与内存中；支持**v3**签名，可更改签名证书 |
| DEX 文件的 ART 提前转换                 | ART会对DEX文件进行提前的压缩与优化                           |
| 后台限制                                | 后台应用不允许访问传感器（包括摄像头、麦克风、陀螺仪等）     |
| 权限限制                                | 读取通话记录权限由PHONE权限组中移出到CALL_LOG，并无法读取本机号码与状态 |
| 非SDK接口限制                           | 非SDK接口设置黑名单、灰名单和白名单，前者使用时会抛出异常，后者在不同版本会有等同在黑名单和白名单中的不同效果。 |
| Android Test变更                        | 将JUnit分为三个新的库，依赖变更                              |
| 证书的主机名验证变更                    | 当`SAN`(subjectAltName)校验失败时，Android 不再回退到使用 `CN`（commonName）。 要验证主机名，服务器必须出示具有匹配 `SAN` 的证书。 不包含与主机名匹配的 `SAN` 的证书不再被信任。 |
| 系统文件访问限制                        | 不再允许应用直接读取 `/proc/net/xt_qtaguid` 文件夹中的文件。 这样做是为了确保与某些根本不提供这些文件的设备保持一致。 |
| Intent Flag要求                         | 从非Activity环境启动Activity时，Intent必须携带FLAG_ACTIVITY_NEW_TASK（由于Android N中的一个错误，导致N与O没有执行这个要求） |
| 屏幕旋转变更                            | 原来的屏幕纵向模式变更为旋转锁定，在屏幕方向没有设定为横向或纵向时，用户可以选择其锁定的方向 |
| 枚举相机                                | 可以通过API获取每一个可用摄像头列表                          |
| targetSDK 28+ 变更                      | 前台服务需要声明FOREGROUND_SERVICE，否则会抛异常；Build.SERIAL始终为”UNKNOW“；WebView的缓存及Cookie数据会根据**进程**分设在不同的目录；应用没有访问公有Linux域的权限；没有高度和宽度的View不能获取焦点，且Activity不会再在轻触模式下隐式分配初始焦点；WebView支持带ARGB值的css颜色；`file：`URI必须声明MIME类型，否则未带后缀名的文件会被解析成纯文本 |



[Android Q 官方文档介绍](https://developer.android.google.cn/about/versions/10?hl=zh_cn)

**加粗**的内容需要有空的时候依次试一遍。

| 特性                                | 说明                                                         |
| ----------------------------------- | ------------------------------------------------------------ |
| 支持可折叠设备                      | 对Activity生命周期进行了改进，onResume在该版本会对所有可见且可聚焦的Activity调用，之前只会有已获取焦点的Activity被调用；支持可折叠设备模拟器 |
| 支持5G                              | 支持5G功能检查相应API                                        |
| 通知智能回复                        | 可以设置系统通过通知内容自动设置对应的回复与跳转路径         |
| **支持系统级的深色主题**            | 可以使用Force Dark对当前主题进行强制深色转化，或者借助DayNight兼容库在老版本上定制深色主题。 |
| **全局手势模式**                    | 支持从屏幕边缘发起手势代替原来的导航栏，此时也不展示通知栏   |
| **设置面板**                        | 可以通过Intent请求在当前页面展示一个浮动的设置面板进行需要的设置 |
| 安全性改进                          | 引入了无需硬件支持的加密方式`Adiantum`;网络通信默认启用TLS1.3，且不再信任sha-1签名的证书;改进了生物识别流程，加入了无需二次确认的选项 |
| 音频与媒体                          | 支持相机获取动态景深图片；允许其他应用捕获本应用的音频；更多地支持了`Vulkan`（新一代图形与计算API） |
| ART优化支持                         | 可以通过提供ART配置文件优化虚拟机执行效率；优化了GC算法      |
| 新增Thermal API                     | 可以用这个API监听设备温度状况，以调整程序工作密度            |
| **分区存储**                        | 目标平台为Android Q及以后的应用，不再能随意访问外部存储空间，但可以免权限访问`getExternalFileDir()`指向的应用自身存储空间以及媒体库中自己创建的媒体文件；如果需要访问其他文件，则需要调用存储访问框架（**SAF**），以此保证应用文件归属可溯及管理分层 |
| 后台位置权限                        | 当应用处于后台时，需要申请**ACCESS_BACKGROUND_LOCATION**权限才能获取定位 |
| 后台启动Activity限制                | 增加了从后台启动Activity的限制，阻止后台不经同意弹出Activity导致当前任务中断。 |
| 联系人亲密度信息移除                | 在获取联系人列表时不再根据互动频率排序                       |
| **MAC地址随机分配**                 | Android Q以上版本将不再向应用提供展示真实的MAC地址           |
| 系统文件访问限制                    | 现在不允许应用访问`/proc/net` 文件系统（网络状态相关）       |
| **设备标识符限制**                  | 只有申请了专项权限`READ_PRIVILEGED_PHONE_STATE`（第三方应用无法申请该权限）的应用能访问，在target SDK < 29的平台，则会返回null或者占位符数据 |
| **剪切板访问限制**                  | 只有当应用为输入法或者当前持有焦点的应用时，才能访问剪切板数据 |
| USB序列号访问限制                   | 仅当用户授予应用访问 USB 设备或配件的权限后才能读取序列号    |
| 摄像头数据访问权限                  | Android Q以后 `getCameraCharacteristics()`返回的部分数据需要拥有CAMERA权限才能获得 |
| WLAN管理限制                        | 应用无法再通过代码开启或关闭WIFI，只能提醒用户去设置自行开启 |
| 定位权限                            | 一些电话 API、蓝牙 API 和 WLAN API 需要精确位置权限`ACCESS_FINE_LOCATION`才能使用 |
| 权限更新                            | `READ_FRAME_BUFFER`、`CAPTURE_VIDEO_OUTPUT` 和 `CAPTURE_SECURE_VIDEO_OUTPUT`等权限只能通过签名授权的方式访问，禁止再以静默方式访问设备屏幕内容；对于target SDK < 23 的应用，在安装前会提供权限关闭页面来控制权限授予；从 Android 10 开始，应用无法在界面中查询权限的分组方式。 |
| 系统二进制文件/库会映射到只执行内存 | 如果对只执行内存进行读取，会得到系统的`SIGSEGV`信号，其报错类似`Cause: execute-only (no-read) memory access error; likely due to data in .text.` |
| HTTPS连接变更                       | 如果在 Android 10 上运行的应用将 `null` 传递给 `setSSLSocketFactory()`则会出现 `IllegalArgumentException`。 |
| **运行时变更**(封死了插件化的路？)  | 以 Android 10 为目标平台的不可信应用无法再针对应用主目录中的文件调用 `exec()`，无法针对已通过 `dlopen()` 打开的文件中的可执行代码进行内存中修改；ART 不再从应用进程调用 `dex2oat`，即ART 将仅接受系统生成的 OAT 文件；自定义类加载器不再预先编译；辅助dex文件由后台OAT编译，可能导致执行延迟；Android 中的共享库（Android 清单中的 \<library\> 和 \<uses-library\> 条目）在实现时使用的类加载器层次结构与先前版本的平台中所用的不同。 |
| API更新                             | 增加了WebView渲染可用情况的回调方法；[其他改进](<https://developer.android.google.cn/about/versions/10/features?hl=zh_cn#system-tracing>) |

